# [운영체제] - 교착 상태

운영체제가 맡는 역할 중 교착 상태를 해결하는 것도 중요한 임무이다. 교착 상태, 자원 할당 그래프에 대해 알아보자!

<hr>

<br>

### - 교착 상태

[교착 상태를 잘 설명해 주는 예시 - 식사하는 철학자 문제](https://namu.wiki/w/%EC%8B%9D%EC%82%AC%ED%95%98%EB%8A%94%20%EC%B2%A0%ED%95%99%EC%9E%90%20%EB%AC%B8%EC%A0%9C)

게임 프로세스가 자원 A를 점유한 채 크롬 프로세스가 점유하고 있는 자원 B의 사용이 끝나길 기다리고, 크롬 브라우저는 자원 B를 점유한 채 게임 프로세스의 자원 A 사용이 끝나길 기다린다고 할 때, 게임과 크롬은 상대방이 가진 자원을 기다리기만 하다가 결국 실행 한 번 못하는 상황이 벌어진다. 이를 `교착 상태`라고 한다.

교착 상태를 해결하기 위하여!

1. 교착 상태가 발생했을 때의 상황을 정확히 표현한다.
2. 교착 상태가 일어나는 근본적인 이유에 대해 알아야 한다.

<br>

### - 자원 할당 그래프

```text
어떤 프로세스가 어떤 자원을 사용하고, 어떤 자원을 기다리고 있는지를 표현하는 간단한 그래프
```

자원 할당 그래프는 다음과 같이 그려진다. 

1. 프로세스는 원으로, 자원의 종류는 사각형으로 표현한다.
2. 사용할 수 있는 자원의 개수는 자원 사각형 내의 점으로 표현한다.
3. 프로세스가 어떤 자원을 할당받아 사용 중이라면 자원에서 프로세스를 향해 화살표를 표시한다.
4. 프로세스가 어떤 자원을 기다리고 있다면, 프로세스에서 자원으로 화살표를 표시한다.

![image-20221207010320048](%5B%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%5D%20-%20%EA%B5%90%EC%B0%A9%20%EC%83%81%ED%83%9C.assets/image-20221207010320048.png)

- 현재 사용 가능한 SSD 자원은 3개, CPU 자원은 2개, 프린터는 1개
- 프로세스 A는 SSD를 할당받아 사용 중이고, 프로세스 B와 C는 CPU를 할당받아 사용중, 프로세스 D는 프린터 사용 중
- 프로세스 E는 프린터 자원을, 프로세스 F는 CPU의 할당을 기다리고 있다.

![image-20221207010501703](%5B%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%5D%20-%20%EA%B5%90%EC%B0%A9%20%EC%83%81%ED%83%9C.assets/image-20221207010501703.png)

교착 상태의 자원 할당 그래프로, 교착 상태가 발생하는 상황은 자원 할당 그래프가 `원`의 형태를 띄고 있다.

<BR>

### - 교착 상태 발생 조건

아래 조건이 모두 만족될 때 교착 상태가 발생할 가능성이 생긴다고 보면 된다.

#### 1. 상호 배제

교착 상태가 발생한 근본적인 원인은 해당 자원을 한 번에 하나의 프로세스만 이용 가능했기 때문이다. 프로세스도 마찬가지로 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때, 즉 `상호 배제` 상황에서 교착 상태가 발생할 수 있다. 

#### 2. 점유와 대기

자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태를 `점유와 대기`라고 한다. 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다린다면 교착상태가 발생할 수 있다.

#### 3. 비선점

프로세스가 자원을 `비선점` 하고 있기 때문에 교착 상태가 발생할 수 있다. 즉, 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못했기 때문에 교착 상태가 발생할 수 있다. 

#### 4. 원형 대기

자원 할당 그래프가 원의 형태를 띈다고 반드시 교착 상태가 발생하는 것은 아니지만, 발생할 수 있다. 이렇게 프로세스들이 원의 형태로 자원을 대기하는 것을 `원형 대기` 라고 한다. 
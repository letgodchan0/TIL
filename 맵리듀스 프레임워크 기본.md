# 맵리듀스 프레임워크

- 맵리듀스 프레임워크에서는 각각의 레코드 또는 튜플은 (키, 값) 쌍으로 표현된다.
- 주된 구성요소는 맵리듀스와 HDFS라 불리는 Hadoop 분산 파일시스템이다.
  - 맵리듀스는 소프트웨어의 수행을 분산한다.
  - HDFS는 데이터를 분산한다.
- 맵리듀스 프레임워크는 메인 함수를 한 개의 마스터 머신에서 수행하는데, 이 머신은 맵 함수를 수행하기 전에 전처리를 하거나 리듀스 함수의 결과를 후처리 하는데 사용될 수 있다.
- 컴퓨팅은 맵과 리듀스라는 유저가 정의한 함수를 이용하여 드라이버에 해당하는 메인 프로그램에서 맵 함수를 먼저 수행하고 그 다음에 리듀스 함수를 수행하는데, 때에 따라서 맵 함수가 끝난 후에 컴바인 함수를 중간에 수행하고 그 다음에 리듀스 함수를 수행할 수도 있다.

<br>

### 맵 함수

- `org.apache.hadoop.mapreduce`라는 패키지 안에 있는 Mapper 클래스를 상속받아서 map 메소드를 수정한다.

- 입력 텍스트 파일에서 라인 단위로 호출이 되는데 (키, 값)의 형태인 입력에서 키는 입력 텍스트 파일에서 맨 앞 문자를 기준으로 맵 함수가 호출된 해당 라인의 첫 번째 문자까지의 오프셋(offset)을 가지며 값에는 해당 라인 전체가 들어간다.

<br>

### 리듀스 함수

- `org.apache.hadoop.mapreduce` 패키지에 있는 Reducer 클래스를 상속받아서 reduce 메소드를 수정한다.
- 셔플링 페이즈를 거친 후에 (key, value-list)의 형태로 입력이 들어오며 value-list는 맵 함수의 출력에서 같은 key를 갖는 (key, value) 쌍들의 value들의 리스트로 구성된다.

<br>



### 맵 페이즈

- 텍스트  문서의 각 라인마다 map 함수가 호출되고 문서를 스캔하면서 각 단어마다 그 단어를 key로 하고 값 1을 value로 해서 (key, value) 쌍을 출력한다.
- 입력으로 들어오는 (key, value)에서 key는 입력 텍스트 파일에서 맨 앞 문자를 기준으로 맵 함수가 호출된 해당 라인의 첫 번째 문자까지의 오프셋을 가지며 value에는 해당 라인 전체가 들어있다.
- map 함수가 다 끝나고 나면 출력한 (key, value) 쌍의 key에 따라서 해시 함수 같은 것을 이용해서 여러 머신에 분산하여 보낸다.
- 여기서 같은 key를 가진 (key, value) 쌍은 반드시 같은 머신으로 보내진다. 

<br>

### 셔플링 페이즈

- 맵 페이즈가 끝나면 Map 함수들이 출력한 (key, value) 쌍을 key를 이용하여 정렬하고 난 후에 각각의 key마다 그 key를 가진 value들을 모아서 value-list를 만들고 (key, value-list) 형태로 출력한다.
- (key, value-list) 형태의 셔플링 페이즈 결과에 대해서 각각의 key마다 해당되는 value-list와 함께 reduce 함수가 호출된다. 

<br>

### 리듀스 페이즈

- 셔플링 페이즈가 끝나면 각각의 (key, value-list) 쌍에 대해서 각각의 key마다 reduce 함수가 호출된다.
- 각각의 reduce 함수는 입력으로 주어진 (key, value-list) 쌍에 대해서 value-list에 있는 값들을 다 합한 값을 value로 만들어서 (key, value) 형태로 출력한다. 
# 🌱 SQL Injection

> 해커에 의해 조작된 SQL 쿼리문이 데이터 베이스에 그대로 전달되어 비정상적 명령을 실행시키는 공격 기법

<br>

## 공격 방법 

#### 1) 인증 우회

보통 로그인을 할 때 아이디와 비밀번호를 input 창에 입력하게 된다. 쉽게 이해하기 위해 가벼운 예를 들어보면, 아이디가 apple 비밀번호가 banana일 때 쿼리는 아래와 같은 방식으로 전송될 것이다.

```sql
SELECT * FROM USER WEHRE ID = 'apple' AND PASSWORD = 'banana';
```

SQL Injection으로 공격할 때, input 창에 비밀번호를 입력함과 동시에 다른 쿼리문을 함께 입력하는 것이다. 

```sql
banana; DELETE * USER FROM ID = '1';
```

보완이 완벽하지 않은 경우, 이처럼 비밀번호가 아이디와 일치해서 True가 되고 뒤에 작성한 DELETE 문도 데이터베이스에 영향을 줄 수 있게 되는 치명적인 상황이다.

이 밖엥도 기본 쿼리문의 WHERE 절에 OR문을 추가하여 `'1' = '1'` 과 같은 True문을 작성하여 무조건 적용되도록 수정한 뒤 DB를 마음대로 조작할 수도 있다.

<br>

#### 2) Blind SQL Injection

가장 많이 쓰이는 sql injection 공격 기법 중 하나로 일부로 맞지 않는 질의를 보내 참 거짓을 판별하여 공격하는 기법이다. 가장 많이 쓰이는 것은 `length` 함수와 `substring` 함수이다. `length`는 보통 컬럼값의 길이를 알아내기 위해서 먼저 사용하고, 그 다음에 `substring`는 하나씩 문자를 알아내는 방식으로 사용된다. 

<br>

#### 3) 데이터 노출

시스템에서 발생하는 에러 메시지를 이용해 공격하는 방법이다. 보통 에러는 개발자가 버그를 수정하는 면에서 도움을 받을 수 있는 존재다. 해커들은 이를 역이용해 악의적인 구문을 삽입하여 에러를 유발시킨다.

예를들면, 해커는 `GET` 방식으로 동작하는 `URL` 쿼리 스트링을 추가하여 에러를 발생시킨다. 이에 해당하는 오류가 발생하면, 이를 통해 해당 웹앱의 데이터베이스 구조를 유추할 수 있고 해킹에 활용한다. 

<BR>







##  방어 방법

#### 1) Input 값을 받을 때, 특수 문자 여부 검사하기

로그인 전, 검증 로직을 추가하여 미리 설정한 특수 문자들이 들어왔을 때 요청을 막아낸다. 

#### 2) SQL 서버 오류 발생 시, 해당하는 에러 메시지 감추기

view를 활용하여 원본 데이터베이스 테이블에는 접근 권한을 높인다. 일반 사용자는 view로만 접근하여 에러를 볼 수 없도록 만든다.

#### 3) preparestatement 사용하기

preparestatement를 사용하면, 특수문자를 자동으로 escaping 해준다. (statement와는 다르게 쿼리문에서 전달인자 값을 `?`로 받는 것) 이를 활용해 서버 측에서 필터링 고 ㅏ정을 통해서 공격을 방어한다. 